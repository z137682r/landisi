<?phpnamespace app\home\controller;use think\Db;use think\Request;use clt\Form;class Index extends Common{    public function _initialize(){        parent::_initialize();    }    public function index(){          $str="";          if(!empty(input('sd'))){          	    	  $map['sd']=input('sd');    	  if(input('sd')==1){    	      $str="暖色";    	  }elseif(input('sd')==2){    	  	  $str="冷色";}    	  } if(!empty(input('cz'))){ 	 	 	  if(input('cz')==1){    	      $str="柚木";    	  }elseif(input('cz')==2){    	  	  $str="胡桃木";    	  }elseif(input('cz')==3){    	  	  $str="枫木";    	  }elseif(input('cz')==4){    	  	  $str="水曲柳";    	  }elseif(input('cz')==5){    	  	  $str="橡木";    	  }    	 	    	  $map['cz']=input('cz');}if(!empty(input('hw'))){			 	 	  if(input('hw')==1){    	      $str="秋香";    	  }elseif(input('hw')==2){    	  	  $str="铁刀";    	  }elseif(input('hw')==3){    	  	  $str="斑马";    	  }elseif(input('hw')==4){    	  	  $str="青藤";    	  }	    	  $map['hw']=input('hw');}if(!empty(input('hd'))){			 	 	  if(input('hd')==1){    	      $str="3mm";    	  }elseif(input('hd')==2){    	  	  $str="5mm";    	  }elseif(input('hd')==3){    	  	  $str="9mm";    	  }elseif(input('hd')==4){    	  	  $str="15mm";    	  }elseif(input('hd')==5){    	  	  $str="18mm";    	  }    	      	  $map['hd']=input('hd');}if(!empty(input('gy'))){		 	 	  if(input('gy')==1){    	      $str="单面";    	  }elseif(input('gy')==2){    	  	  $str="双面";    	  }elseif(input('gy')==3){    	  	  $str="高光";    	  }elseif(input('gy')==4){    	  	  $str="浮雕";    	  }elseif(input('gy')==5){    	  	  $str="锯齿";    	  }elseif(input('gy')==6){    	  	  $str="加长";    	  }elseif(input('gy')==7){    	  	  $str="加宽";    	  }	    	  $map['gy']=input('gy');}if(!empty(input('cc'))){		   	  if(input('cc')==1){    	      $str="木皮板尺寸：2440mm * 1220mm";    	  }elseif(input('cc')==2){    	  	  $str="木皮仿步尺寸：2440mm * 610mm";}    	  $map['cc']=input('cc');}    	  //$map['gy']=input('gy');    	  $list=db('product')->alias('a')                    ->join(config('database.prefix').'category c','a.catid = c.id','left')                    ->where($map)                    ->field('a.*,c.catdir')                    ->order('listorder asc,createtime desc')                    ->paginate($this->pagesize);                // 获取分页显示                $page = $list->render();                $list = $list->toArray();                foreach ($list['data'] as $k=>$v){                    $list['data'][$k]['controller'] = $v['catdir'];                    $list_style = explode(';',$v['title_style']);                    $list['data'][$k]['title_color'] =$list_style[0];                    $list['data'][$k]['title_weight'] =$list_style[1];                    $title_thumb = $v['thumb'];                    $list['data'][$k]['title_thumb'] = $title_thumb?__PUBLIC__.$title_thumb:__HOME__.'/images/portfolio-thumb/p'.($k+1).'.jpg';                }                $this->assign('list',$list['data']);   $this->assign('str',$str);                $this->assign('page',$page);/////////////////  $donation = db('picture')->order('id desc')->paginate($this->pagesize);                $dpage = $donation->render();                $dlist = $donation->toArray();                $this->assign('dlist',$dlist['data']);                $this->assign('dpage',$dpage);                $list = db('picture')->where('catid=28')->order('listorder asc,createtime desc')->select();                foreach ($list as $k=>$v){                    $list_style = explode(';',$v['title_style']);                    $list[$k]['title_color'] =$list_style[0];                    $list[$k]['title_weight'] =$list_style[1];                    $title_thumb = $v['thumb'];                    $list[$k]['title_thumb'] = $title_thumb?__PUBLIC__.$title_thumb:__HOME__.'/images/portfolio-thumb/p'.($k+1).'.jpg';                }                       $this->assign('options',$list);                ////////////////////////////////////                 $donation = db('article')->order('id desc')->paginate($this->pagesize);                $dpage = $donation->render();                $dlist = $donation->toArray();                $this->assign('dlist',$dlist['data']);                $this->assign('dpage',$dpage);                $list = db('article')->where('1=1')->order('listorder asc,createtime desc')->limit(6)->select();                foreach ($list as $k=>$v){                    $list_style = explode(';',$v['title_style']);                    $list[$k]['title_color'] =$list_style[0];                    $list[$k]['title_weight'] =$list_style[1]; $list[$k]['createtime'] =date('Y-m-d', $list[$k]['createtime']);                    $title_thumb = $v['thumb'];                    $list[$k]['title_thumb'] = $title_thumb?__PUBLIC__.$title_thumb:__HOME__.'/images/portfolio-thumb/p'.($k+1).'.jpg';                }                $this->assign('news',$list);             return $this->fetch();    }    public function wzdt(){        $maps = db('navigation')->where(['status'=>1,'pid'=>0])->order('sort')->select();        if($maps){            foreach ($maps as $key => $val){                $maps[$key]['child'] = db('navigation')->where(['status'=>1,'pid'=>$val['id']])->order('sort')->select();            }        }        $this->assign('maps',$maps);    	return $this->fetch('wzdt');    }      public function news_list(){   	   	         $donation = db('article')->order('id desc')->paginate($this->pagesize);                $dpage = $donation->render();                $dlist = $donation->toArray();                $this->assign('dlist',$dlist['data']);                $this->assign('dpage',$dpage);                $list = db('article')->where('1=1')->order('listorder asc,createtime desc')->limit(20)->select();                foreach ($list as $k=>$v){                    $list_style = explode(';',$v['title_style']);                    $list[$k]['title_color'] =$list_style[0];                    $list[$k]['title_weight'] =$list_style[1];                    $list[$k]['createtime'] =date('Y-m-d', $list[$k]['createtime']);                    $title_thumb = $v['thumb'];                    $list[$k]['title_thumb'] = $title_thumb?__PUBLIC__.$title_thumb:__HOME__.'/images/portfolio-thumb/p'.($k+1).'.jpg';                }            $this->assign('page',$page);            $this->assign('news',$list);            return $this->fetch('news_list');   }    public function product(){    	   $str=[];          if(!empty(input('sd'))){    	  $map['sd']=input('sd');    	  if(input('sd')==1){    	      $str['sd']="暖色";    	  }elseif(input('sd')==2){              $str['sd']="冷色";}    	  }        if(input('kw') != ''){            $map['a.title'] = ['like','%'.input('kw').'%'];        } if(!empty(input('cz'))){ 	 	 	  if(input('cz')==1){              $str['cz']="柚木";    	  }elseif(input('cz')==2){              $str['cz']="胡桃木";    	  }elseif(input('cz')==3){              $str['cz']="枫木";    	  }elseif(input('cz')==4){              $str['cz']="水曲柳";    	  }elseif(input('cz')==5){              $str['cz']="橡木";    	  }    	 	    	  $map['cz']=input('cz');}if(!empty(input('hw'))){		 	 	  if(input('hw')==1){              $str['hw']="秋香";    	  }elseif(input('hw')==2){              $str['hw']="铁刀";    	  }elseif(input('hw')==3){              $str['hw']="斑马";    	  }elseif(input('hw')==4){              $str['hw']="青藤";    	  }	    	  $map['hw']=input('hw');}if(!empty(input('hd'))){			 	 	  if(input('hd')==1){              $str['hd']="3mm";    	  }elseif(input('hd')==2){              $str['hd']="5mm";    	  }elseif(input('hd')==3){              $str['hd']="9mm";    	  }elseif(input('hd')==4){              $str['hd']="15mm";    	  }elseif(input('hd')==5){              $str['hd']="18mm";    	  }    	      	  $map['hd']=input('hd');}if(!empty(input('gy'))){		 	 	  if(input('gy')==1){              $str['gy']="单面";    	  }elseif(input('gy')==2){              $str['gy']="双面";    	  }elseif(input('gy')==3){              $str['gy']="高光";    	  }elseif(input('gy')==4){              $str['gy']="浮雕";    	  }elseif(input('gy')==5){              $str['gy']="锯齿";    	  }elseif(input('gy')==6){              $str['gy']="加长";    	  }elseif(input('gy')==7){              $str['gy']="加宽";    	  }	    	  $map['gy']=input('gy');}if(!empty(input('cc'))){		   	  if(input('cc')==1){              $str['cc']="木皮板尺寸：2440mm * 1220mm";    	  }elseif(input('cc')==2){              $str['cc']="木皮仿步尺寸：2440mm * 610mm";}    	  $map['cc']=input('cc');}    	  //$map['gy']=input('gy');    	  $list=db('product')->alias('a')                    ->join(config('database.prefix').'category c','a.catid = c.id','left')                    ->where($map)                    ->field('a.*,c.catdir')                    ->order('listorder asc,createtime desc')                    ->paginate(10,false,['query'=>request()->param()]);                // 获取分页显示                $page = $list->render();                $list = $list->toArray();                foreach ($list['data'] as $k=>$v){                    $list['data'][$k]['controller'] = $v['catdir'];                    $list_style = explode(';',$v['title_style']);                    $list['data'][$k]['title_color'] =$list_style[0];                    $list['data'][$k]['title_weight'] =$list_style[1];                    $title_thumb = $v['thumb'];                    $list['data'][$k]['title_thumb'] = $title_thumb?__PUBLIC__.$title_thumb:__HOME__.'/images/portfolio-thumb/p'.($k+1).'.jpg';                }                $this->assign('list',$list['data']);        $this->assign('str',$str);        $map['kw'] = input('kw');        unset($map['a.title']);        $this->assign('map',$map);                $this->assign('page',$page);    	    return $this->fetch('product_list');    }    public function picture_show(){        $info =db('picture')->where('id',input('id'))->find();       $info11 =db('category')->where('id',$info['catid'])->find();                $this->assign('catname',$info11['catname']);        $info['pic'] = $info['pic']?__PUBLIC__.$info['pic']:__HOME__."/images/sample-images/blog-post".rand(1,3).".jpg";        $title_style = explode(';',$info['title_style']);        $info['title_color'] = $title_style[0];        $info['title_weight'] = $title_style[1];         $title_thumb = $info['thumb'];        $info['title_thumb'] = $title_thumb?__PUBLIC__.$title_thumb:__HOME__.'/images/sample-images/blog-post'.rand(1,3).'.jpg';            $pics = explode(':::',$info['pics']);            foreach ($pics as $k=>$v){            $info['pics'][$k] = explode('|',$v);        }        $this->assign('info',$info);        return $this->fetch('picture_show');    }     public function new_show(){        $info =db('article')->where('id',input('id'))->find();        $info11 =db('category')->where('id',$info['catid'])->find();                $this->assign('catname',$info11['catname']);        $info['pic'] = $info['pic']?__PUBLIC__.$info['pic']:__HOME__."/images/sample-images/blog-post".rand(1,3).".jpg";        $title_style = explode(';',$info['title_style']);        $info['title_color'] = $title_style[0];        $info['title_weight'] = $title_style[1];         $title_thumb = $info['thumb'];        $info['title_thumb'] = $title_thumb?__PUBLIC__.$title_thumb:__HOME__.'/images/sample-images/blog-post'.rand(1,3).'.jpg';            $pics = explode(':::',$info['pics']);            foreach ($pics as $k=>$v){            $info['pics'][$k] = explode('|',$v);        }        $this->assign('info',$info);        return $this->fetch('news_show');    }    public function productinfo(){        $info =db('product')->where('id',input('id'))->find();        $info11 =db('category')->where('id',$info['catid'])->find();        $this->assign('catname',$info11['catname']);        $info['pic'] = $info['pic']?__PUBLIC__.$info['pic']:__HOME__."/images/sample-images/blog-post".rand(1,3).".jpg";        $title_style = explode(';',$info['title_style']);        $info['title_color'] = $title_style[0];        $info['title_weight'] = $title_style[1];        $title_thumb = $info['thumb'];        $info['title_thumb'] = $title_thumb?__PUBLIC__.$title_thumb:__HOME__.'/images/sample-images/blog-post'.rand(1,3).'.jpg';        if(DBNAME=='picture'){            $pics = explode(':::',$info['pics']);            foreach ($pics as $k=>$v){                $info['pics'][$k] = explode('|',$v);            }        }        $this->assign('info',$info);        $donation = db('picture')->order('id desc')->paginate($this->pagesize);        $dpage = $donation->render();        $dlist = $donation->toArray();        $this->assign('dlist',$dlist['data']);        $this->assign('dpage',$dpage);        $list = db('picture')->where('catid=28')->order('listorder asc,createtime desc')->select();        foreach ($list as $k=>$v){            $list_style = explode(';',$v['title_style']);            $list[$k]['title_color'] =$list_style[0];            $list[$k]['title_weight'] =$list_style[1];            $title_thumb = $v['thumb'];            $list[$k]['title_thumb'] = $title_thumb?__PUBLIC__.$title_thumb:__HOME__.'/images/portfolio-thumb/p'.($k+1).'.jpg';        }        $this->assign('options',$list);        return $this->fetch('product_show');    }}